---
title: "Упорядочение и индексация пространственных данных"
subtitle: "Геоинформатика I"
date: today
date-format: long
author: "Самсонов Тимофей Евгеньевич"
execute:
  echo: false
  freeze: true
engine: knitr
format:
  revealjs: 
    theme: [default, custom.scss]
    margin: 0.2
    width: 1280
    height: 720
    slide-number: true
    footer: "Самсонов Т. Е. Геоинформатика: курс лекций"
    header-includes: <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/pt-sans" type="text/css"/>
bibliography: references.yaml
mainfont: PT Sans
---

## Генерация Z-кривой и кривой Гильберта

**Задача**: разбить территорию на $N \times N$ ячеек, упорядочив их по близости.

::: columns
::: {.column width="60%"}
**Общий алгоритм**:

1.  Начать с представления области в виде одной ячейки ($k = 0$).

2.  Итерировать по $k = 1, ..., n-1$, где $n = \log_2N$

    -   разбить территорию на $2^k \times 2^k$ блоков;

    -   вычислить номера ячеек.

::: callout-tip
## Размер блока на каждой итерации

На каждой итерации каждая ячейка заменяется на 4 блока размером $2^{n-k} \times 2^{n-k}$.
:::
:::

::: {.column width="40%"}
![](images/curve_subdivision.svg){width="100%"}
:::
:::

## Генерация Z-кривой

::: columns
::: {.column width="50%"}
1.  Конвертировать в бинарное представление индексы ячеек $u$ (по $X$) и $v$ (по $Y$).

    $$
    \color{blue}{u = 10}, \color{red}{v = 10}
    $$

2.  Расположить биты полученных значен ий вперемежку (через один):

    $$
    \color{violet}{w =} \color{blue}{1}\color{red}{1}\color{blue}{0}\color{red}{0}
    $$

3.  Вычислить десятичный номер полученного значения

    $$
    \color{violet}{1100_2} \rightarrow \color{green}{12_{10}}
    $$
:::

::: {.column width="50%"}
![](images/zcurve.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Конвертировать в бинарное представление индексы ячеек $u$ и $v$.
:::

::: {.column width="50%"}
![](images/guilbert1.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Конвертировать в бинарное представление индексы ячеек $u$ и $v$.

2.  Расположить биты полученных значений вперемежку (через один).
:::

::: {.column width="50%"}
![](images/guilbert2.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Конвертировать в бинарное представление индексы ячеек $u$ и $v$.

2.  Расположить биты полученных значений вперемежку (через один).

3.  Разделить полученное число *слева направо* на двухбитные строки.
:::

::: {.column width="50%"}
![](images/guilbert3.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Конвертировать в бинарное представление индексы ячеек $u$ и $v$.

2.  Расположить биты полученных значений вперемежку (через один).

3.  Разделить полученное число *слева направо* на двухбитные строки.

4.  Сопоставить каждой двухбитной строке десятичную цифру $d$ по правилам:

    $$
    \texttt{00} \rightarrow 0,~\texttt{01} \rightarrow 1\\\texttt{10} \rightarrow 3,~\texttt{11} \rightarrow 2
    $$
:::

::: {.column width="50%"}
![](images/guilbert4.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Представить полученные значения $d$ в виде списка (одномерного массива) $D$.
:::

::: {.column width="50%"}
![](images/guilbert5.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Представить полученные значения $d$ в виде списка (одномерного массива) $D$.

2.  В цикле по $k \leftarrow 0…n-1$, где $n = |D|$:

    -   если $d_k = 0$, то для всех $m > k$ заменить $d_m = 1$ на $3$, а $d_m = 3$ на $1$.

    -   если $d_k = 3$, то для всех $m > k$ заменить $d_m = 0$ на $2$, а $d_m = 2$ на $0$.
:::

::: {.column width="50%"}
![](images/guilbert6.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Представить полученные значения $d$ в виде списка (одномерного массива) $D$.

2.  В цикле по $k \leftarrow 0…n-1$, где $n = |D|$:

    -   если $d_k = 0$, то для всех $m > k$ заменить $d_m = 1$ на $3$, а $d_m = 3$ на $1$.

    -   если $d_k = 3$, то для всех $m > k$ заменить $d_m = 0$ на $2$, а $d_m = 2$ на $0$.

3.  Преобразовать каждую цифру в истинное 2-битовое представление
:::

::: {.column width="50%"}
![](images/guilbert7.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

::: columns
::: {.column width="50%"}
1.  Представить полученные значения $d$ в виде списка (одномерного массива) $D$.

2.  В цикле по $k \leftarrow 0…n-1$, где $n = |D|$:

    -   если $d_k = 0$, то для всех $m > k$ заменить $d_m = 1$ на $3$, а $d_m = 3$ на $1$.

    -   если $d_k = 3$, то для всех $m > k$ заменить $d_m = 0$ на $2$, а $d_m = 2$ на $0$.

3.  Преобразовать каждую цифру в истинное 2-битовое представление.

4.  Вычислить искомый номер.
:::

::: {.column width="50%"}
![](images/guilbert8.svg){width="100%"}
:::
:::

## Генерация кривой Гильберта

1.  Конвертировать в бинарное представление индексы ячеек $i$ и $j$.

2.  Расположить биты полученных значений вперемежку (через один).

3.  Разделить полученное число *слева направо* на двухбитные строки.

4.  Сопоставить каждой двухбитной строке десятичную цифру $d$ по правилам:

    $$
    \texttt{00} \rightarrow 0,~\texttt{01} \rightarrow 1,~\texttt{10} \rightarrow 3,~\texttt{11} \rightarrow 2
    $$

5.  Представить полученные значения $d$ в виде списка (одномерного массива) $D$.

6.  В цикле по $k \leftarrow 0…n-1$, где $n = |D|$:

    -   если $d_k = 0$, то для всех $m > k$ заменить $d_m = 1$ на $3$, а $d_m = 3$ на $1$.

    -   если $d_k = 3$, то для всех $m > k$ заменить $d_m = 0$ на $2$, а $d_m = 2$ на $0$.

7.  Преобразовать каждую цифру в истинное 2-битовое представление

8.  Вычислить искомый номер.

## Библиография
