---
title: "Топологические отношения"
subtitle: "Геоинформатика I. Базы пространственных данных"
date: today
date-format: long
author: "Самсонов Тимофей Евгеньевич"
execute:
  echo: false
  freeze: true
engine: knitr
format:
  revealjs: 
    theme: [default, custom.scss]
    margin: 0.2
    width: 1280
    height: 720
    slide-number: true
    footer: "Самсонов Т. Е. Геоинформатика: курс лекций"
    header-includes: <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/pt-sans" type="text/css"/>
bibliography: references.yaml
mainfont: PT Sans
---

## История развития

Модели топологических отношений разработаны в первой половине 90-х гг. ХХ в.:

1.  Модель 4 пересечений **4IM** [@egenhofer1991].
2.  Модель 9 пересечений **9IM** [@egenhofer1991a; @egenhofer1991b].
3.  Модель 4 пересечений с размерностью **DE-4IM** [@clementini1993].
4.  Аналитическая модель **CBM** [@clementini1993].
5.  Модель 9 пересечений с размерностью **DE-9IM** [@clementini1995].

Наибольший вклад внесли два ученых:

-   [**Max Egenhofer**](https://scholar.google.de/citations?user=wS3m298AAAAJ&hl=en) (*University of Maine, USA*)

-   [**Eliseo Clementini**](https://scholar.google.com/citations?user=d6i4GswAAAAJ&hl=ru) (*University of L'Aquila, Italy*)

## Обозначения

::: columns
::: {.column width="50%"}
|                    |                            |
|--------------------|----------------------------|
| $P$                | точка                      |
| $L$                | линия                      |
| $A$                | полигон                    |
| $\lambda$          | $P|L|A$                    |
| $\partial$         | граница                    |
| $^\circ$           | внутренность               |
| $^-$               | внешняя область            |
| $\cap$             | пересечение                |
| $\varnothing$      | пустое множество           |
| $\neg \varnothing$ | непустое множество         |
| $-$                | нуль (отсутствие значения) |
:::

::: {.column width="50%"}
**Вычисление размерности**

Функция $\dim(S)$ применительно к произвольному множеству точек $S$ дает следующие значения:

|     |                                                                      |
|------|------------------------------------------------------------------|
| $-$ | если $S = \varnothing$                                               |
| $0$ | если $S$ содержит хотя бы одну точку и не содержит линий и полигонов |
| $1$ | если $S$ содержит хотя бы одну линию и не содержит полигонов         |
| $2$ | если $S$ содержит хотя бы один полигон                               |
:::
:::

## Определения

**Граница**

-   $\partial P$: граница точки всегда пуста ($\partial P = \varnothing$)

-   $\partial L$: граница линии состоит из ее конечных точек или пуста если линия замкнута

-   $\partial A$: граница полигона состоит из кривых, представляющих его предельные точки

**Внутренность** произвольного объекта $\lambda$ определяется как:

$$
\lambda^\circ = \lambda - \partial \lambda
$$

**Внешняя область** произвольного объекта $\lambda$ определяется как:

$$
\lambda^\circ = \mathbb R^2 - \lambda
$$

## Модель 4-пересечений 4IM

-   Анализ пересечений внутренней области и границы двух объектов $\lambda_1$ и $\lambda_2$.

-   Каждое пересечение может быть пустым ($\varnothing$) или не пустым ($\neg \varnothing$), что дает $2^4 = 16$ комбинаций.

::: columns
::: {.column width="60%"}
Каждая комбинация представляется в виде матрицы пересечений

$$
M=\begin{pmatrix}
\lambda_1^\circ  \cap \lambda_2^\circ   &   \lambda_1^\circ \cap \partial \lambda_2 \\
\partial \lambda_1 \cap \lambda_2^\circ   &    \partial \lambda_1 \cap \partial \lambda_2
\end{pmatrix}
$$

::: callout-note
## Обратные отношения

Соответствуют матрицам $M_1$ и $M_2$, для которых справедливо $M_1 = M_2^T$
:::
:::

::: {.column width="40%"}
| $\lambda_1 \lambda_2$ | Возможно | Без обратных |
|-----------------------|----------|--------------|
| $AA$                  | 8        | 6            |
| $LA$                  | 11       | 11           |
| $PA$                  | 3        | 3            |
| $LL$                  | 16       | 12           |
| $PL$                  | 3        | 3            |
| $PP$                  | 2        | 2            |
|                       | *Итого*  | *37*         |
:::
:::

## Модель 9-пересечений 9IM

-   Анализ пересечений внутренней области, границы и внешней области двух объектов $\lambda_1$ и $\lambda_2$.

-   Cочетания пустых ($\varnothing$) и не пустых ($\neg \varnothing$) дают $2^9 = 512$ комбинаций.

::: columns
::: {.column width="60%"}
Каждая комбинация представляется в виде матрицы пересечений

$$
M=\begin{pmatrix}
\lambda_1^\circ  \cap \lambda_2^\circ & \lambda_1^\circ \cap \partial \lambda_2 & \lambda_1^\circ \cap \lambda_2^- \\
\partial \lambda_1 \cap \lambda_2^\circ & \partial \lambda_1 \cap \partial \lambda_2 & \partial \lambda_1 \cap \lambda_2^- \\
\lambda_1^-  \cap \lambda_2^\circ & \lambda_1^- \cap \partial \lambda_2 & \lambda_1^- \cap \lambda_2^-
\end{pmatrix}
$$

::: callout-note
## Обратите внимание

Число комбинаций меняется только между линиями ($LL$) и между линиями и полигонами ($LA$).
:::
:::

::: {.column width="40%"}
| $\lambda_1\lambda_2$ | Возможно | Без обратных |
|----------------------|----------|--------------|
| $AA$                 | 8        | 6            |
| $LA$                 | 19       | 19           |
| $PA$                 | 3        | 3            |
| $LL$                 | 33       | 23           |
| $PL$                 | 3        | 3            |
| $PP$                 | 2        | 2            |
|                      | *Итого*  | *56*         |
:::
:::

## Модель 4-п. с размерностью DE-4IM

-   Анализ пересечений внутренней области и границы двух объектов $\lambda_1$ и $\lambda_2$.

-   Размерность пересечения может быть $-, 0, 1, 2$, что дает $4^4 =256$ комбинаций.

::: columns
::: {.column width="60%"}
Каждая комбинация представляется в виде матрицы пересечений

$$
M=\begin{pmatrix}
\dim(\lambda_1^\circ  \cap \lambda_2^\circ)   &   \dim(\lambda_1^\circ \cap \partial \lambda_2) \\
\dim(\partial \lambda_1 \cap \lambda_2^\circ)   & \dim(\partial \lambda_1 \cap \partial \lambda_2)
\end{pmatrix}
$$

::: callout-note
## Максимальная размерность пересечения

Меньше или равна минимальной размерности объектов, участвующих в пересечении
:::
:::

::: {.column width="40%"}
| $\lambda_1 \lambda_2$ | Возможно | Без обратных |
|-----------------------|----------|--------------|
| $AA$                  | 12       | 9            |
| $LA$                  | 17       | 17           |
| $PA$                  | 3        | 3            |
| $LL$                  | 24       | 18           |
| $PL$                  | 3        | 3            |
| $PP$                  | 2        | 2            |
|                       | *Итого*  | *52*         |
:::
:::

## Подсчет реальных комбинаций

Для подсчета реальных комбинаций необходимо посмотреть на возможные размерности пересечений

$$
\begin{pmatrix}
\dim(L^\circ  \cap A^\circ)   &   \dim(L^\circ \cap \partial A) \\
\dim(\partial L \cap A^\circ)   & \dim(\partial L \cap \partial A)
\end{pmatrix} = 
\begin{pmatrix}
\{-,1\}   &   \{-, 0, 1\} \\
\{-,0\}  & \{-,0\}
\end{pmatrix}
$$

$$
\begin{pmatrix}
\dim(L_1^\circ  \cap L_2^\circ)   &   \dim(L_1^\circ \cap \partial L_2) \\
\dim(\partial L_1 \cap L_2^\circ)   & \dim(\partial L_1 \cap \partial L_2)
\end{pmatrix} = 
\begin{pmatrix}
\{-,0,1\}   &   \{-, 0\} \\
\{-,0\}  & \{-,0\}
\end{pmatrix}
$$

$$
\begin{pmatrix}
\dim(A_1^\circ  \cap A_2^\circ)   &   \dim(A_1^\circ \cap \partial A_2) \\
\dim(\partial A_1 \cap A_2^\circ)   & \dim(\partial A_1 \cap \partial A_2)
\end{pmatrix} = 
\begin{pmatrix}
\{-,2\}   &   \{-, 1\} \\
\{-, 1\}  & \{-,0,1\}
\end{pmatrix}
$$

В каждом случае остается 24 комбинации из 256. Из них убираются невозможные и обратные друг другу отношения.

## Модель 9-п. с размерностью DE-9IM

-   Анализ пересечений внутренней области, границы и внешней области двух объектов $\lambda_1$ и $\lambda_2$.

-   Размерность пересечения может быть $-, 0, 1, 2$, что дает $4^9 =262144$ комбинаций.

Каждая комбинация представляется в виде матрицы пересечений

$$
M=\begin{pmatrix}
\dim(\lambda_1^\circ  \cap \lambda_2^\circ) & \dim(\lambda_1^\circ \cap \partial \lambda_2) & \dim(\lambda_1^\circ \cap \lambda_2^-) \\
\dim(\partial \lambda_1 \cap \lambda_2^\circ) & \dim(\partial \lambda_1 \cap \partial \lambda_2) & \dim(\partial \lambda_1 \cap \lambda_2^-) \\
\dim(\lambda_1^-  \cap \lambda_2^\circ) & \dim(\lambda_1^- \cap \partial \lambda_2) & \dim(\lambda_1^- \cap \lambda_2^-)
\end{pmatrix}
$$

## Модель 9-пересечений с размерностью

::: columns
::: {.column width="60%"}
-   Анализ пересечений внутренней области, границы и внешней области двух объектов $\lambda_1$ и $\lambda_2$.

-   Размерность пересечения может быть $-, 0, 1, 2$, что дает $4^9 =262144$ комбинаций.

::: callout-note
## DE-9IM

Модель DE-9IM описывает наиболее полный спектр топологических отношений и поддерживается в большинстве систем управления базами пространственных данных.
:::
:::

::: {.column width="40%"}
| $\lambda_1 \lambda_2$ | Возможно | Без обратных |
|-----------------------|----------|--------------|
| $AA$                  | 12       | 9            |
| $LA$                  | 31       | 31           |
| $PA$                  | 3        | 3            |
| $LL$                  | 36       | 33           |
| $PL$                  | 3        | 3            |
| $PP$                  | 2        | 2            |
|                       | *Итого*  | *81*         |
:::
:::

## **DE-4/8IM (01-08) точки**

![](images/DE-8IM_01-08.svg){width="100%"}

## **DE-4/8IM (09-17) полигоны**

![](images/DE-8IM_09-17.svg){width="100%"}

## **DE-4/8IM (18-25) линии/полигоны**

![](images/DE-8IM_18-25.svg){width="100%"}

## **DE-4/8IM (26-33) линии/полигоны**

![](images/DE-8IM_26-33.svg){width="100%"}

## **DE-4/8IM (34-43) линии/полигоны**

![](images/DE-8IM_34-43.svg){width="100%"}

## **DE-4/8IM (44-48) линии/полигоны**

![](images/DE-8IM_44-48.svg){width="100%"}

## **DE-4/8IM (49-58) линии**

![](images/DE-8IM_49-58.svg){width="100%"}

## **DE-4/8IM (59-69) линии**

![](images/DE-8IM_59-69.svg){width="100%"}

## **DE-4/8IM (70-78) линии**

![](images/DE-8IM_70-78.svg){width="100%"}

## **DE-4/8IM (70-78) линии**

![](images/DE-8IM_79-81.svg){width="100%"}

## Библиография
