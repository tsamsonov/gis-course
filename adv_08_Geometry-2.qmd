---
title: "Геометрические операции — II"
subtitle: "Геоинформатика I. Базы пространственных данных"
date: today
date-format: long
author: "Самсонов Тимофей Евгеньевич"
execute:
  echo: false
  freeze: true
engine: knitr
format:
  revealjs: 
    theme: [default, custom.scss]
    margin: 0.2
    width: 1280
    height: 720
    slide-number: true
    footer: "Самсонов Т. Е. Геоинформатика: курс лекций"
    header-includes: <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/pt-sans" type="text/css"/>
bibliography: references.yaml
mainfont: PT Sans
---

## Основные операции

::: columns
::: {.column width="50%"}
1.  Расстояния между объектами
2.  Периметр линии
3.  Площадь полигона
4.  Точка относительно прямой
5.  Точка относительно отрезка
6.  Пересечение отрезков
7.  Точка в полигоне
8.  Ограничивающий прямоугольник
9.  Выпуклая оболочка
10. Минимальный прямоугольник
:::

::: {.column width="50%"}
1.  **Пересечение множества отрезков**
2.  Оверлей полигонов
3.  Слияние линий и полигонов
4.  Полигонизация линий
5.  Буферная зона
6.  Триангуляция Делоне
7.  Диаграмма Вороного
8.  Скелет и срединная ось полигона
9.  Центроид и точка на поверхности
10. Вогнутая оболочка
:::
:::

## Особенности пересечения отрезков

::: columns
::: {.column width="50%"}
Если проекции отрезков на любую ось не пересекаются, то и сами отрезки также не пересекаются

![](images/segment_projections.svg){width="100%"}
:::

::: {.column width="50%"}
Пересечению отрезков всегда предшествует их последовательное расположение относительно прямой

![](images/segment_sequence.svg){width="100%"}
:::
:::

## Сканирующая линия (sweeping line)

**Общий принцип:** прямая линия (вертикальная или горизонтальная) сканирует сцену в перпендикулярном направлении и отслеживает события, связанные с пересечениями объектов. Пройденные события остаются позади.

**Основные компоненты:**

1.  *Сканирующая линия.* Структура данных, которая в каждый момент времени содержит информацию о пересекаемых объектах. Обновляется при перемещении линии.
2.  *Очередь событий.* Структура данных, которая содержит перечень событий --- координат, в которых меняется состав или порядок пересекаемых объектов. Пройденные события удаляются, но при этом могут возникать новые.
3.  *Выходная структура данных*.

В общем случае число пересечений имеет порядок $O(n^2)$, и алгоритм сканирующей линии позволяет проверять не все пары отрезков.

## Алгоритм Бентли-Оттмана

Определяет пересечения для множества отрезков методом сканирующей линии [@bentley1979].

**Изначальные допущения:**

1.  Вертикальная линия перемещается в направлении оси $X$.
2.  Нет вертикальных отрезков и касаний в точках
3.  В каждой точке пересекается не более двух отрезков

**Сканирующая линия** $L$ содержит идентификаторы отрезков $s$, упорядоченных в направлении оси $Y$. Обозначения: $s^-$ --- предыдущий, $s^+$ --- следующий отрезок.

**Очередь** $E$ содержит события двух типов:

-   Все конечные точки отрезков (известны заранее)

-   Точки пересечения отрезков (вычисляются налету)

## Алгоритм Бентли-Оттмана

Определяет пересечения для множества отрезков методом сканирующей линии [@bentley1979].

**Входные данные**

$n$ отрезков $s_i = \overline{q_i r_i},~i = 0...n-1$

**Выходные данные**

Множество $R = \{(x, y, i, j)\}$ кортежей пересечений между парами отрезков, где $x,y$ --- координаты точки пересечения, $i, j$ --- номера (идентификаторы) отрезков

**Начальная инициализация**

-   отсортировать $2n$ конечных точек по возрастанию координаты $X$ и наполнить ими $E$;

-   $L = \varnothing$;

-   $R = \varnothing$.

## Алгоритм Бентли-Оттмана [@sacristán2022]

Пока $E \neq \varnothing$, выполнять в цикле:

1.  $p = \min E$
2.  Если $p = \textrm{start}(s)$:
    -   $L = L \cup s$
    -   $r = s^- \cap s$. Если $r \neq \varnothing \land r >_x p$, то $E = E \cup r$, $R = R \cup r$. Тоже для $s^+$ и $s$
3.  Если $p = \textrm{end}(s)$:
    -   $r = s^- \cap s^+$. Если $r\neq \varnothing \land r >_x p$ то $E = E \cup r$, $R = R \cup r$.
    -   $L = L~\backslash~s$
4.  Если $p = s_1 \cap s_2$ при $s_1 <_L s_2$:
    -   $r = s_1^- \cap s_2$. Если $r \neq \varnothing \land r >_x p$ то $E = E \cup r$, $R = R \cup r$. Тоже для $s_2^+$ и $s_1$
    -   Поменять местами $s_1$ и $s_2$ в $L$
5.  $E = E~\backslash~p$.

```{r, results='asis'}
for (i in 1:79) {
  cat('\n\n## Алгоритм Бентли-Оттмана (симуляция)\n\n')
  cat('![](images/bentley-ottman/bentley-ottman_', i,'.svg){width="100%"}', sep = '')
}
```

## Алгоритм Бентли-Оттмана (свойства)

Гарантируется, что алгоритм находит все существующие пересечения, и не находит несуществующих пересечений.

Особенности обработки частных случаев [@sacristán2022]:

1.  Если входные данные содержат точки с совпадающими абсциссами, их необходимо сортировать не только по координате X, но также по принадлежности к отрезку.

2.  Данных, которые выдает алгоритм, достаточно для того чтобы определить линейные пересечения (в этом случае отрезки будут пересекаться дважды).

3.  Если 3 и более отрезков пересекаются в одной точке, то алгоритм при возникновении парных событий должен менять их местами в сканирующей линии (так же как и в случае двух отрезков).

## Библиография
