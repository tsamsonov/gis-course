---
title: "Векторный анализ"
subtitle: "Основы геоинформатики. Лекция 4"
date: 03/10/2023
date-format: long
author: "Самсонов Тимофей Евгеньевич"
execute:
  echo: false
  freeze: true
engine: knitr
format:
  revealjs: 
    theme: [default, custom.scss]
    margin: 0.2
    slide-number: true
    footer: "Самсонов Т. Е. Основы геоинформатики: курс лекций для студентов географического факультета МГУ"
    header-includes: <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/pt-sans" type="text/css"/>
bibliography: references.yaml
mainfont: PT Sans
---

## Длина / периметр

::: columns
::: {.column width="50%"}
Рассчитываются как сумма длин отрезков, составляющих контур объекта:

$$
L =\\ \sum_{i=0}^{n-2}\sqrt{(x_{i+1}-x_i)^2 + (y_{i+1}-y_i)^2}
$$

::: callout-note
## Полигон

У полигона последняя точка должна иметь такие же координаты, как и первая.
:::
:::

::: {.column width="50%"}
![](images/perimeter.svg){width="100%"}
:::
:::

## Площадь

::: columns
::: {.column width="50%"}
Рассчитывается как сумма площадей трапеций, ограниченных сверху отрезками, составляющими контур объекта:

$$
A = \frac{1}{2}\sum_{i=0}^{n-2} \underbrace{(y_{i+1}+y_{i})}_{\texttt{основания}}\underbrace{(x_{i+1}-x_{i})}_{\texttt{высота}}
$$

::: callout-note
## Отрицательная площадь

Трапеции, у которых $i+1$-я точка имеет меньший X, чем $i$-я, имеют отрицательную площадь.
:::
:::

::: {.column width="50%"}
![](images/area.svg){width="100%"}
:::
:::

## Принадлежность точки полигону

Луч, выпущенный из точки в направлении оси $X$, пересекает границу полигона **нечетное** количество раз.

::: columns
::: {.column width="60%"}
![](images/point_polygon.svg){width="90%"}
:::

::: {.column width="40%"}
::: callout-note
## Обратите внимание

Если луч пересекает одну из *вершин* полигона, и оба примыкающих к ней отрезка находятся по одну сторону от луча, это засчитывается как два пересечения.
:::
:::
:::

::: callout-tip
## Применение

Данная операция активно используется при оценке топологических отношений --- например, для выполнения пространственных запросов.
:::

## Ограничивающий прямоугольник

::: columns
::: {.column width="50%"}
**Ограничивающий прямоугольник** определяет охват данных по осям координат.

Задаётся координатами углов:

-   левого нижнего $(x_{min}, y_{min})$

-   правого верхнего $(x_{max}, y_{max})$
:::

::: {.column width="50%"}
![](images/bbox.svg){width="100%"}
:::
:::

::: callout-tip
## Применение

Ограничивающий прямоугольник является важным элементом *метаданных* --- описания пространственных данных, но также используется и в аналитических задачах.
:::

## Выпуклая оболочка

::: columns
::: {.column width="50%"}
**Выпуклая оболочка** --- наименьший по площади выпуклый многоугольник, *покрывающий* заданное множество точек.

::: callout-note
## Выпуклое множество

Множество, в котором отрезок, соединяющий любые две точки также находится внутри этого множества.

![](images/non_convex.svg){width="65%"}
:::
:::

::: {.column width="50%"}
![](images/convex_hull.svg){width="75%"}

::: callout-tip
## Применение

Выпуклые оболочки используются для восстановления ареалов по точечным измерениям. Также выпуклая оболочка является границей *триангуляционного покрытия*.
:::
:::
:::

## Выпуклая оболочка

Известный метод построения --- **алгоритм Джарвиса** [@jarvis1973]:

::: columns
::: {.column width="50%"}
-   находим *нулевую* точку с минимальной координатой $X$;

-   ищем *первую* точку с минимальным дирекционным углом;

-   получаем отрезок $p_0 p_1$;

-   продолжаем поиск, находя следующий отрезок, образующий минимальный угол поворота относительно предыдущего.
:::

::: {.column width="50%"}
![](images/jarvis.gif)
:::
:::

## Диаграмма Вороного

::: columns
::: {.column width="40%"}
![](images/voronoy_outline.svg){width="100%"}
:::

::: {.column width="60%"}

Диаграмма Вороного

:   Диаграмма Вороного конечного множества точек $S$ на плоскости представляет такое разбиение плоскости, при котором каждая область этого разбиения образует множество точек, более близких к одному из элементов множества $S$, чем к любому другому элементу множества.
:::
:::

::: callout-tip
## Применение

Диаграмма Вороного используется при моделировании зон влияния объектов.
:::

## Триангуляционное покрытие

Элементы триангуляционной модели имеют свои названия.

![](images/tin_details_7.svg){width="100%"}

## Центроид и срединная ось

::: columns
::: {.column width="50%"}
**Центроид** --- точка, представляющая среднее значение координат полигона без учета последней точки:

$$
C = \Bigg(\frac{1}{n}\sum_{i=0}^{n-2} x_i, \frac{1}{n}\sum_{i=0}^{n-2} y_i \Bigg)
$$

**Срединная ось** --- линия равноудаленная от границ полигона.
:::

::: {.column width="50%"}
![](images/centroid_axis.svg){width="100%"}
:::
:::

::: callout-tip
## Применение

Используются для картографической генерализации.
:::

## Буферные зоны

**Буферная зона** --- это множество точек, располагающихся в пределах заданного расстояния относительно объекта.

::: columns
::: {.column width="40%"}
-   буфер точки представляет собой круг;

-   буфер полигона может быть положительным и отрицательным;

-   буфер точки или линии всегда положительный.
:::

::: {.column width="60%"}
![](images/buffering.svg){width="65%"}
:::
:::

::: callout-tip
## Применение

Используются при анализе влияния. Например, определения водоохранных зон.
:::

## Преобразование моделей объектов

Между любыми моделями пространственных объектов возможны взаимные преобразования.

::: columns
::: {.column width="60%"}
![](images/conversions.svg){width="100%"}
:::

::: {.column width="40%"}
::: callout-tip
## Применение

Например, можно получить из полигона заповедника поворотные точки его границы. Или восстановить линию почвенного профиля по точкам разрезов.
:::

::: callout-important
## Мультигеометрия

При конвертации полигона или линии в точки обычно получается мультиточечный объект.
:::
:::
:::

## Преобразования мультиобъектов

В некоторых случаях требуется преобразовать мультиобъект в множество отдельных объектов и наоборот.

![](images/multi_conv.svg){width="100%"}

::: callout-tip
## Применение

Например, требуется провести анализ в пределах отдельных островов архипелага.
:::

## Слияние (объединение по признаку)

**Слияние** (объединение по признаку) --- это объединение геометрий пересекающихся объектов с одинаковым значением атрибута.

![](images/dissolve.svg){width="85%"}

::: callout-tip
## Применение

Слияние всегда сопровождает агрегирование атрибутов и используется при укрупнении единиц картографирования. Также может применяться при векторизации, когда объект создается по фрагментам, которые далее необходимо объединить.
:::

## Оверлей

**Оверлей** --- пространственное наложение двух или более пространственных объектов, при котором образуется их геометрическая и атрибутивная композиция.

![](images/overlay.svg){width="100%"}

**Оверлей** --- одна из самых полезных геометрических операций.

## Оверлей

::: columns
::: {.column width="50%"}
*Пересечение* используется для **обрезки данных** по указанной области.

Область обрезки может быть произвольной, но чаще всего используется ограничивающий прямоугольник

::: callout-note
## Clip

Обрезка данных *(clip)* является частным случаем пересечения с полигональным объектом, при котором наследуются только атрибуты обрезаемых объектов.
:::
:::

::: {.column width="50%"}
![](images/clip.svg){width="100%"}
:::
:::

## Оверлей

::: columns
::: {.column width="50%"}
**Пространственная ассоциация** --- взаимосвязь местоположения объектов --- также может быть исследована путем оверлея.

Для двух классов $A$ и $B$:

-   односторонняя ассоциация:\
    $|A \cap B|/ |A|$

-   двусторонняя ассоциация:\
    $|A \cap B| / |A \cup B|$
:::

::: {.column width="50%"}
![](images/assoc.svg){width="80%"}
:::
:::

Для анализа ассоциации двух явлений --- например *типов почв и рельефа* --- состоящих из множества классов, используются специальные индексы. Например, индекс [**Крамера V**](https://en.wikipedia.org/wiki/Cramér%27s_V).

## Оверлей

::: columns
::: {.column width="50%"}
**Пространственные соотношения** различных типов объектов в пределах заданных участков также определяются методом оверлея.

Доля класса $A$ в пределах участка $C$:

$$
|A \cap C|/ |C|
$$
:::

::: {.column width="50%"}
![](images/ratio.svg){width="100%"}
:::
:::

::: callout-tip
## Пример

Модели формирования речного стока работают на растровой сетке и требуют задания соотношения типов подстилающей поверхности для каждой ячейки.
:::

## Отношение геометрии и атрибутов

В геореляционных базах данных допустимое множество операций над атрибутом также зависит от того как он получен относительно пространства.

**Опора измерений** --- физический объем, подвергнутый измерению.

::: columns
::: {.column width="50%"}
::: callout-note
## Экстенсивные атрибуты

Пропорциональны опоре измерений. Суммируются при объединении территорий и делятся при разделении.

![Численность населения](images/extensive.svg){width="100%"}
:::
:::

::: {.column width="50%"}
::: callout-note
## Интенсивные атрибуты

Не пропорциональны опоре измерений. Осредняются при объединении территорий и остаются прежними при разделении.

![Плотность населения](images/intensive.svg){width="100%"}
:::
:::
:::

## Оверлей

**Интерполяция, взвешенная на площадь** --- способ пересчета количественного показателя между сетками учетных единиц.

::: columns
::: {.column width="50%"}
Для каждой из $q$ выходных единиц $T_j$, средневзвешенное значение $Y_i$ извлеченное из $p$ исходных единиц $S_i$, равно:

$$
\hat{Y_j}(T_j) = \sum_{i=1}^p w_{ij} Y_i(S_i)
$$

-   экстенсивная: $w_{ij} = \frac{|T_j \cap S_i|}{|S_i|}$

-   интенсивная: $w_{ij} = \frac{|T_j \cap S_i|}{|T_j|}$
:::

::: {.column width="50%"}
![](images/areaweighted.svg){width="100%"}
:::
:::

## Словарик

::: columns
::: {.column width="50%" style="color: blue; text-align: end;"}
Огранич. прямоугольник

Выпуклая оболочка

Диаграмма Вороного

Центроид

Срединная ось

Буферная зона

Слияние

Оверлей

Обрезка

Интерполяция, взвешенная на площадь
:::

::: {.column width="50%" style="color: red"}
Bounding box

Convex hull

Voronoy diagram

Centroid

Medial axis

Buffer

Dissolve

Overlay

Clip

Area-weighted interpolation
:::
:::

## Библиография
