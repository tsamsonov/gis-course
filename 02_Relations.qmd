---
title: "Создание объектов и пространственные отношения"
subtitle: "Основы геоинформатики. Лекция 2"
date: 02/17/2023
date-format: long
author: "Самсонов Тимофей Евгеньевич"
execute:
  echo: false
engine: knitr
format:
  revealjs: 
    theme: [default, custom.scss]
    margin: 0.2
    slide-number: true
    footer: "Самсонов Т. Е. Основы геоинформатики: курс лекций для студентов географического факультета МГУ"
    header-includes: <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/pt-sans" type="text/css"/>
bibliography: references.yaml
mainfont: PT Sans
---

## Создание объектов

Создание векторных пространственных объектов осуществляется разными способами. Наиболее распространены:

1.  **Автоматическое конструирование** на основе координат.

2.  **Геокодирование** --- преобразование географических идентификаторов в координаты.

3.  **Векторизация** --- создание объектов в ручном режиме, либо путем преобразования из других моделей данных.

    ::: callout-tip
    ## Уточнение

    Векторизации-преобразованию обычно подвергаются растровые данные.
    :::

4.  **Геометрические операции** --- получение новых векторных объектов в результате операций над существующими объектами.

## Автоматическое конструирование

#### Маршрут --- линейный объект

::: columns
::: {.column width="50%"}
**Исходные данные**

![](images/image-11396456.png)

![](images/image-1313555464.png)
:::

::: {.column width="50%"}
**Simple Feature**

```         
Geometry set for 1 feature 
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 36.34891 ymin: 55.19607 xmax: 36.38429 ymax: 55.21918
Geodetic CRS:  WGS 84
LINESTRING (36.38314 55.20975, 36.38314 55.20976, 36.3832 55.20997, 36.38321 55.21001, 36.38321 55.21002, 36.38325 55.21007...
```
:::
:::

## Автоматическое конструирование

#### Поле --- площадной объект

::: columns
::: {.column width="50%"}
**Исходные данные**

![](images/image-587177276.png)

![](images/image-635340267.png)
:::

::: {.column width="50%"}
**Simple Feature**

```         
Geometry set for 1 feature 
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 36.37781 ymin: 55.18984 xmax: 36.38543 ymax: 55.19887
Geodetic CRS:  WGS 84
POLYGON ((36.38543 55.19842, 36.38538 55.19825, 36.38533 55.19806, 36.38528 55.19785, 36.38525 55.19763, 36.38513 55.19745,...
```
:::
:::

## Автоматическое конструирование

#### Геодезические пункты --- точечные объекты

::: columns
::: {.column width="50%"}
**Исходные данные**

![](images/image-1928425450.png)
:::

::: {.column width="50%"}
**Simple Feature**

``` {style="font-size: 8"}
Simple feature collection with 2 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 36.34953 ymin: 55.19612 xmax: 36.37369 ymax: 55.2188
Geodetic CRS:  WGS 84
N Name    geometry
  <chr>   <POINT [°]>
1 Африка  (36.34953 55.19612)
2 Сенокос (36.37369 55.2188)
```
:::
:::

## Автоматическое конструирование

::: columns
::: {.column width="60%"}
![](images/field_map.png)
:::

::: {.column width="40%"}
Пример использования --- построение карт по результатам полевых работ.

::: callout-caution
## Ограничения

Сырые данные ГНСС-измерений содержат погрешности. Поэтому векторные объекты, созданные на их основе, часто нуждаются в редактировании, в том числе с использованием геометрических операций.
:::
:::
:::

## Географические идентификаторы

Увязаны с местоположением, идентифицируемым географическими объектами. Взаимосвязь с объектом может быть установлена следующими основными способами:

-   **локализацией**, когда конкретная позиция находится внутри географического объекта, например в стране;

-   **локальными измерениями**, когда позиция определена относительно фиксированных точек географических объектов, например вдоль улицы на заданном расстоянии от пересечения с другой улицей. Этот аспект известен как *линейная привязка*;

-   **слабо связанным способом**, когда позиция имеет нечеткую взаимосвязь с географическими объектами, например рядом со зданием или между двумя зданиями.

## Геокодирование

Географический идентификатор [@gost:70316-2022]

:   Пространственная привязка в виде текстового обозначения или кода, определяющего местоположение

Географический справочник (газеттир)

:   Реестр экземпляров местоположений одного или более подтипов местоположений, содержащих некоторую информацию о позиции.

::: callout-note
## Адресный локатор

Географический справочник почтовых адресов и их местоположения обычно называют *адресным локатором*.
:::

## Адресное геокодирование

```{mermaid}
%%| fig-width: 11
flowchart LR
  A(Адрес) --> B(Геокодер)
  C(Адресный локатор) --> B
  B --> D(Координаты)
```

**Адресный локатор** хранит набор набор векторных объектов, для каждого из которых задано структурированное описание адреса, разбитое на компоненты: индекс, регион, нас. пункт, улица и т.д.

**Геокодер** находит в локаторе наиболее вероятное местоположение, соответствующее переданному адресу.

## Адресное геокодирование

Адресное геокодирование позволяет автоматизировать преобразование текстовых данных в пространственные.

::: columns
::: {.column width="45%"}
**Исходные данные**

![](images/addr_source.png){width="90%"}
:::

::: {.column width="55%"}
**Результаты геокодирования**

![](images/addr_res.png){width="90%"}
:::
:::

## Векторизация

**Векторизация** может осуществляться в автоматическом, автоматизированном и ручном режиме.

-   *Автоматическая векторизация* используется, например, при конвертации покрытий, хранящих категориальные данные, в набор векторных объектов.

    ![](images/vectorize.svg){width="65%"}

## Векторизация

**Векторизация** может осуществляться в автоматическом, автоматизированном и ручном режиме.

-   *Автоматизированная векторизация* используется, например, при выделении объектов на космических снимках и сканированных картах. Результирующие объекты требуют редактирования.

    ![](images/image-91314596.png)

    @yurtseven2019

## Векторизация

**Векторизация** может осуществляться в автоматическом, автоматизированном и ручном режиме.

::: columns
::: {.column width="30%"}
![](images/vec_manual_crop.gif)
:::

::: {.column width="70%"}
-   *Ручная векторизация* используется, когда автоматизированные методы не дают удовлетворительного результата, или когда надо создать новый векторный объект, для которого нет образца.

::: callout-tip
## Операции редактирования

Ручная векторизация похожа на работу в векторных графических редакторах. Объекты можно не только создавать, но также разрезать, присоединять, вырезать в них дырки и т.д.
:::
:::
:::

## Цифрование

Цифрование

:   Получение цифрового представления объектов.

::: callout-tip
## Пример

Классические пример цифрования --- получение растра топографической карты по результатам сканирования.
:::

::: callout-warning
## Соотношение с векторизацией

**Цифрование** --- более общий термин, чем *векторизация*. Для обозначения процесса создания векторных объектов необходимо употреблять термин *векторизация*.
:::

## Пространственные отношения

Отношение

:   Свойство двух или более объектов, выраженное в наличии или отсутствии определенной связи между ними.

Пространственное отношение

:   Отношение пространственных объектов, которое зависит от их местоположения.

::: callout-note
## Предикат

Формальным представлением отношения является **предикат** --- функция, определенная на множестве объектов и принимающая для их упорядоченного набора значение **1** (`ИСТИНА`) или **0** (`ЛОЖЬ`). Предикаты пространственных отношений называются пространственными.
:::

## Пространственные отношения

К основным видам пространственных отношений относятся:

1.  **Метрические** --- определяются расстояниями между объектами.

2.  **Топологические** --- определяются пересечениями объектов.

3.  **Дирекционные** --- определяются направлениями между объектами

::: callout-note
## Пространственные предикаты

Функции, которые устанавливают наличие метрических, топологических и дирекционных отношений, являются пространственными предикатами.
:::

## Расстояния

::: columns
::: {.column width="50%"}
#### Евклидово расстояние

Используется в плоских прямоугольных системах координат

$$
d(A,B) = \sqrt{(x_A - x_B)^2 + (y_A - y_B)^2}
$$

::: callout-warning
## Ограничения

Евклидово расстояние наследует искажения проекции, а также предполагает, что объекты доступны напрямую.
:::
:::

::: {.column width="50%"}
![](images/dist_euc.svg){fig-align="center" width="70%"}
:::
:::

## Расстояния

::: columns
::: {.column width="50%"}
#### Манхэттенское расстояние

Аппроксимирует реальное расстояние между точками в транспортных сетях с ортогональной планировкой.

$$
d(A,B) = |x_A - x_B| + |y_A - y_B|
$$

::: callout-warning
## Ограничения

Даёт преимущества только в том случае когда дорожная сеть ориентирована по направлениям осей $X$ и $Y$.
:::
:::

::: {.column width="50%"}
![](images/dist_manh.svg){width="70%" fig-align="center"}
:::
:::

## Расстояния

::: columns
::: {.column width="50%"}
#### Геодезические расстояние

Кратчайшее расстояние между точками на поверхности эллипсоида. Для сферы:

$$
d(A,B) = \\ \arccos ( 
\sin \phi_A \sin \phi_B + \\ 
\cos \phi_A \cos \phi_B \cos(\lambda_A - \lambda_B))
$$
:::

::: {.column width="50%"}
![](images/dist_geo.svg){fig-align="center" width="75%"}
:::
:::

::: callout-note
## Геодезическая линия и ортодромия

Линия кратчайшего расстояния *на эллипсоиде* --- **геодезическая**.\
Линия кратчайшего расстояния *на сфере* --- **ортодромия.**
:::

## Метрические отношения

**Метрические отношения** устанавливают расстояния между объектами с использованием выбранной метрики.

![](images/dist_all.svg){width="100%"}

::: callout-note
## Метрики

Для оценки расстояний может использоваться множество других метрик. Они не исчерпываются приведенными примерами.
:::

## Топологические отношения

Топологические отношения можно описать в терминах пересечения трех областей каждого объекта [@egenhofer1991]:

::: columns
::: {.column width="40%"}
-   Внутренняя область ($A^o$)

-   Граница ($\partial A$)

-   Внешняя область ($A^-$)
:::

::: {.column width="60%"}
![](images/egenhofer.svg){fig-align="left" width="70%"}
:::
:::

Матрица Эгенхофера **9-IM** содержит 0 или 1 в зависимости от наличия или отсутствия пересечения:

$$
\begin{bmatrix}
A^o  \cap B^o \ne \emptyset   &   A^o \cap \partial{B} \ne \emptyset & A^o \cap B^- \ne \emptyset \\
\partial{A} \cap B^o \ne \emptyset   &    \partial{A} \cap \partial{B} \ne \emptyset  &  \partial{A} \cap B^- \ne \emptyset \\
A^- \cap B^o \ne \emptyset    &    A^- \cap \partial{B} \ne \emptyset   &   A^-  \cap B^- \ne \emptyset
\end{bmatrix}
$$

## Топологические отношения

::: columns
::: {.column width="60%"}

Не пересекает

:   Внутренняя область и граница **A** не имеют пересечений с внутренней областью и границей **B**

$$
\begin{bmatrix} 
    0 & 0 & \bf{1} \\
    0 & 0 & \bf{1} \\
    \bf{1} & \bf{1} & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что объекты никак не соприкасаются в пространстве.
:::
:::

::: {.column width="40%"}
![](images/topo_disjoint.svg){width="70%"}
:::
:::

## Топологические отношения

::: columns
::: {.column width="60%"}

Равен

:   Границы, внутренние и внешние области **A** пересекаются с *аналогичными* элементами **B**

$$
\begin{bmatrix} 
    \bf{1} & 0 & 0 \\
    0 & \bf{1} & 0 \\
    0 & 0 & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что объекты совпадают.
:::
:::

::: {.column width="40%"}
![](images/topo_equals.svg){width="70%"}
:::
:::

## Топологические отношения

::: columns
::: {.column width="60%"}

Перекрывает

:   Все компоненты **A** пересекаются со всеми компонентами **B**

$$
\begin{bmatrix} 
    \bf{1} & \bf{1} & \bf{1} \\
    \bf{1} & \bf{1} & \bf{1} \\
    \bf{1} & \bf{1} & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что объекты имеют частичное перекрытие.
:::
:::

::: {.column width="40%"}
![](images/topo_overlaps.svg){width="70%"}
:::
:::

## Топологические отношения

::: columns
::: {.column width="60%"}

Касается

:   Внутренняя область и граница **A** не пересекатся с внутренней областью **B** и наоборот.

$$
\begin{bmatrix} 
    0 & 0 & \bf{1} \\
    0 & \bf{1} & \bf{1} \\
    \bf{1} & \bf{1} & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что объекты касаются друг друга снаружи.
:::
:::

::: {.column width="40%"}
![](images/topo_touches.svg){width="70%"}
:::
:::

## Топологические отношения

::: columns
::: {.column width="65%"}

Покрывает

:   Внешняя область **A** не пересекается с границей и внутренней областью **B**, а граница **A** не пересекается с внутренней областью **B**.

$$
\begin{bmatrix} 
    \bf{1} & \bf{1} & \bf{1} \\
    0 & \bf{1} & \bf{1} \\
    0 & 0 & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что один объект содержит внутри себя другой объект, который касается его границы.
:::
:::

::: {.column width="35%"}
![](images/topo_covers.svg){width="70%"}
:::
:::

## Топологические отношения

::: columns
::: {.column width="65%"}

Покрыт

:   Внешняя область **B** не пересекается с границей и внутренней областью **A**, а граница **B** не пересекается с внутренней областью **A**.

$$
\begin{bmatrix} 
    \bf{1} & 0 & 0 \\
    \bf{1} & \bf{1} & 0 \\
    \bf{1} & \bf{1} & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что один объект содержится внутри другого объекта и касается его границы.
:::
:::

::: {.column width="35%"}
![](images/topo_covered.svg){width="70%"}
:::
:::

## Топологические отношения

::: columns
::: {.column width="65%"}

Содержит

:   Внешняя область и граница **A** не пересекается с границей и внутренней областью **B**, остальные пересечения присутствуют.

$$
\begin{bmatrix} 
    \bf{1} & \bf{1} & \bf{1} \\
    0 & 0 & \bf{1} \\
    0 & 0 & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что один объект содержит внутри себя другой объект.
:::
:::

::: {.column width="35%"}
![](images/topo_contains.svg){width="80%"}
:::
:::

## Топологические отношения

::: columns
::: {.column width="65%"}

Внутри

:   Внешняя область и граница **B** не пересекается с границей и внутренней областью **A**, остальные пересечения присутствуют.

$$
\begin{bmatrix} 
    \bf{1} & 0 & 0 \\
    \bf{1} & 0 & 0 \\
    \bf{1} & \bf{1} & \bf{1} \\
\end{bmatrix}
$$

::: callout-note
## Применение

Используется чтобы установить, что один объект содержится внутри другого объекта.
:::
:::

::: {.column width="35%"}
![](images/topo_within.svg){width="70%"}
:::
:::

## Топологические отношения

Пересекает

:   Внутренняя область или граница **A** пересекается с внутренней областью или границей **B**.

![](images/topo_all.svg){fig-align="center" width="100%"}

## Дирекционные отношения

::: columns
::: {.column width="50%"}
**Угловая модель** базируется на вычислении угла направления с точки **A** в точку **B**.

-   Как правило используется дирекционный угол или азимут.

::: callout-caution
## Ограничения

Применима только для точечных объектов
:::
:::

::: {.column width="50%"}
![](images/dir_ang.svg){width="70%"}
:::
:::

## Дирекционные отношения

::: columns
::: {.column width="60%"}
**Прямоугольная модель** разделяет плоскость на 9 секторов относительно прямоугольника, ограничивающего объект.

-   Используется минимальный ограничивающий прямоугольник со сторонами, параллельными осям координат.

::: callout-caution
## Ограничения

Дает качественную оценку направления по сторонам света
:::
:::

::: {.column width="40%"}
![](images/dir_mbr.svg){width="100%"}
:::
:::

## Дирекционные отношения

::: columns
::: {.column width="50%"}
**Проективная модель** используется для оценки направления на третий объект **C** относительно двух других объектов **A** и **B**.

-   Плоскость делится на 4 "конуса", а также область между объектами.

::: callout-caution
## Ограничения

Дает качественную оценку направления и применяется для *движущихся* объектов
:::
:::

::: {.column width="50%"}
![](images/dir_proj.svg){width="100%"}
:::
:::

## Словарик

::: columns
::: {.column width="50%" style="color: blue; text-align: end;"}
Географический справочник

Адресный локатор

Геокодирование

Векторизация

Цифрование

Пространственное отношение

Евклидово расстояние

Геодезическое расстояние

Метрическое отношение

Топологическое отношение

Дирекционное отношение
:::

::: {.column width="50%" style="color: red"}
Gazetteer

Address locator

Geocoding

Vectorization

Digitizing

Spatial relation

Euclidean distance

Geodesic distance

Metric relation

Topological relation

Directional relation
:::
:::

## Сайт курса

![](images/site.png)

<https://tsamsonov.github.io/gis-course/>

## Библиография
