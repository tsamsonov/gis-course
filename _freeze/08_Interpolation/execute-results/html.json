{
  "hash": "6f7994f352d51dcdd74f8ff1855891a9",
  "result": {
    "markdown": "---\ntitle: \"Пространственная интерполяция и вариография\"\nsubtitle: \"Основы геоинформатики: лекция 8\"\ndate: 03/31/2023\ndate-format: long\nauthor: \"Самсонов Тимофей Евгеньевич\"\nexecute:\n  echo: false\n  freeze: true\nengine: knitr\nformat:\n  revealjs: \n    theme: [default, custom_small.scss]\n    margin: 0.2\n    slide-number: true\n    footer: \"Самсонов Т. Е. Основы геоинформатики: курс лекций для студентов географического факультета МГУ\"\n    header-includes: <link rel=\"stylesheet\" media=\"screen\" href=\"https://fontlibrary.org//face/pt-sans\" type=\"text/css\"/>\nbibliography: references.yaml\nmainfont: PT Sans\n---\n\n\n## Пространственная статистика\n\n**Пространственная статистика** --- анализ и моделирование пространственных явлений методами математической статистики.\n\n![](images/spatstat1.svg){width=\"100%\"}\n\n## Пространственная статистика\n\n**Пространственная статистика** --- анализ и моделирование пространственных явлений методами математической статистики.\n\n![](images/spatstat2.svg){width=\"100%\"}\n\n## Пространственные распределения\n\n::: columns\n::: {.column width=\"65%\"}\nМоделирование пространственных распределений включает такие этапы как\n\n1.  Пространственная интерполяция --- восстановление *поля* распределения по ограниченному набору исходных данных.\n2.  Исследование пространственной изменчивости поля распределения.\n\nВ *геостатистическом* анализе исследование изменчивости даёт статистическое обоснование метода интерполяции.\n:::\n\n::: {.column width=\"35%\"}\n![](images/interpolation.svg){width=\"100%\"}\n:::\n:::\n\n## Пространственная интерполяция\n\n**Интерполяция** в общем случае --- это способ нахождения промежуточных значений величины по имеющемуся дискретному набору известных значений\n\n-   Методы которые производят интерполяцию на основе заданной аналитической зависимости, называют **детерминистическими**.\n\n-   Предполагается что анализируемые данные описываются некоторой аналитической функцией $Z(\\mathbf p, \\lambda)$, где $\\mathbf p$ --- точка, а $\\lambda$ --- набор внутренних параметров модели.\n\n-   Задача: на основе известных данных $Z_i = Z(\\mathbf p_i)$, измеренных в точках $\\mathbf p_i$, и другой информации об исследуемом явлении подобрать набор параметров $\\lambda$ и построить функцию $Z(\\mathbf p, \\lambda)$ для всей исследуемой области $S$.\n\n## Узлы интерполяции\n\n-   Как правило, оценка производится в узлах *покрытия*\n-   Наиболее часто используется растровое покрытие\n\n![](images/pts.png)\n\n## Метод ближайшего соседа\n\nВсю область интерполяции можно разбить с помощью диаграммы Вороного на зоны принадлежности к точкам наблюдений\n\n![](images/voron1.png)\n\n## Метод ближайшего соседа\n\nВ пределах каждой ячейки значение интерполируемой величины считается постоянным\n\n![](images/voron2.png)\n\n## Метод ближайшего соседа\n\nКаждый узел интерполяции получает значение, равное значению ближайшей к нему точки наблюдений\n\n![](images/voron3.png)\n\n## Метод ближайшего соседа\n\nРезультирующая поверхность является кусочно-постоянной\n\n![](images/voron4.png)\n\n## На основе триангуляции\n\n::: columns\n::: {.column width=\"60%\"}\nДля каждого треугольника находят уравнение плоскости:\n\n$$Ax + By + Cz + D = 0$$\n\n$$Z(x, y) = -\\frac{1}{C}(Ax+By+D)$$\n\nИскомые коэффициенты $A, B, C, D$ находят решением уравнения: $$\\begin{vmatrix}\nx - x_1 & y - y_1 & z - z_1 \\\\ \nx_2 - x_1 & y_2 - y_1 & z_2 - z_1 \\\\ \nx_3 - x_1 & y_3 - y_1 & z_3 - z_1\n\\end{vmatrix} = 0$$\n:::\n\n::: {.column width=\"40%\"}\n![](images/tin_interp.svg){width=\"100%\"}\n:::\n:::\n\n## На основе триангуляции\n\nВ пределах каждого треугольника --- наклонный участок плоскости.\n\n![](images/tin_linear.png)\n\nХарактерная особенность --- \"изломы\" изолиний при визуализации.\n\n## Обратно взвешенные расстояния\n\nЗначение показателя в произвольной точке получается как средневзвешенная сумма значений в исходных точках.\n\n-   Веса определяются обратно пропорционально расстоянию: чем дальше исходная точка, тем меньший вес она будет иметь:\n\n$$Z(\\mathbf{p}) = \\begin{cases}\n\\dfrac{\\sum_{i = 1}^{n}{ w_i(\\mathbf{p}) Z_i } }{ \\sum_{i = 1}^{n}{ w_i(\\mathbf{p}) } }, & \\text{если } w_i \\neq 0 \\text{ для всех } i, \\\\\n z_i, & \\text{если } w_i = 0 \\text{ для одного } i,\n\\end{cases}$$\n\nгде $w_i(\\mathbf{p}) = | \\mathbf p - \\mathbf p_i | ^{-\\beta}$ --- весовая функция, $n$ --- общее количество точек с исходными данными.\n\n## Обратно взвешенные расстояния\n\n$\\beta = 2$\n\n![](images/idw2.png)\n\n## Обратно взвешенные расстояния\n\n$\\beta = 3$\n\n![](images/idw3.png)\n\n## Обратно взвешенные расстояния\n\n$\\beta = 4$\n\n![](images/idw4.png)\n\n## Обратно взвешенные расстояния\n\n$\\beta = 5$\n\n![](images/idw5.png)\n\n## Обратно взвешенные расстояния\n\n$\\beta \\rightarrow \\infty$\n\n![](images/idwoo.png)\n\nВ предельном случае ОВР вырождается в ближайшего соседа.\n\n## Обратно взвешенные расстояния\n\nХарактерной особенностью метода является *эффект \"бычьих глаз\"*. При визуализации образуется множество замкнутых изолиний.\n\n![](images/idw3.png)\n\n::: callout-important\n## Причина\n\nВ каждой точке исходных данных существует локальный минимум или максимум.\n:::\n\n## Радиальные базисные функции\n\n**Радиальной** называется функция, значение которой зависит только от расстояния между $\\textbf{p}$ и некой точкой $\\textbf{c}$:\n\n$$\\phi(\\textbf{p}, \\textbf{c}) = \\phi\\big(\\lVert \\textbf{p} - \\textbf{c}\\rVert\\big)$$ Интерполируемое значение находится как сумма значений функций с коэффициентами $\\lambda_i$:\n\n$$Z(\\textbf{p}) = \\sum_{i=1}^n \\lambda_i \\phi\\big(\\lVert \\textbf{p} - \\textbf{p}_i\\rVert\\big)$$\n\n$\\lambda_i$ находятся путем решения системы уравнений $Z(p_i) = Z_i$;\n\n::: callout-note\n## Особенность\n\nВ отличие от метода ОВР весовые коэффициенты не зависят от $\\mathbf{p}$.\n:::\n\n## Радиальные базисные функции\n\nМетод **РБФ** является одним из самых гибких благодаря широким возможностям выбора радиальной функции:\n\n-   *Мультиквадрики*: $\\phi(r) = \\sqrt{r^2 + \\delta^2}$\n\n-   *Обратные мультиквадрики*: $\\phi(r) = 1 / \\sqrt{r^2 + \\delta^2}$\n\n-   *Мульти-логарифмическая*: $\\phi(r) = \\ln(r^2 + \\delta^2)$\n\n-   *Сплайны минимальной кривизны*: $\\phi(r) = r^2 \\ln(r^2 + \\delta^2)$\n\nПараметр $\\delta$ влияет на форму РБФ вблизи нулевых расстояний.\n\n::: callout-warning\n## Внимание\n\nПоверхность проходит через исходные точки, но может выходить за пределы исходного диапазона значений.\n:::\n\n## Радиальные базисные функции\n\n*Сплайн минимальной кривизны* дает поверхность, обладающую максимально низкой кривизной между исходными точками.\n\n![](images/spline.png)\n\n## Полиномиальная регрессия\n\nИспользуется для глобальной аппроксимации тренда\n\n$$P_1(x, y) = a + bx + cy$$ $$P_{1.5}(x, y) = a + bx + cy + dxy$$ $$P_{2}(x, y) = a + bx + cy + dxy + ex^2 + fy^2$$ Неизвестные коэффициенты находятся по методу наименьших квадратов решением системы линейных уравнений относительно коэффициентов $a$, $b$ и т.д. Минимизируется функция потери:\n\n$$L = \\sum_{i=1}^{n} \\Large[Z(x_i, y_i) - P_k(x_i, y_i) \\Large]^2$$\n\n## Полиномиальная регрессия\n\nПолином степени 1\n\n![](images/approx1.png)\n\n## Полиномиальная регрессия\n\nПолином степени 2\n\n![](images/approx2.png)\n\n## Полиномиальная регрессия\n\nПолином степени 3\n\n![](images/approx3.png)\n\n## Геостатистика\n\n**Геостатистика** --- раздел пространственной статистики, посвященный исследованию статистических закономерностей пространственных распределений [@matheron1962].\n\nОсновная функция геостатистики --- *вариограмма*:\n\n$$\n\\mathbb E\\big[Z(\\mathbf{p}+\\mathbf{h})-Z(\\mathbf{p})\\big]^2 = 2\\gamma(\\mathbf{h}),\n$$\n\nгде $\\mathbb E$ --- математическое ожидание, $\\mathbf h$ --- вектор.\n\n::: callout-note\n## Особенности\n\n-   Вариограмма показывает насколько данные в точках становятся непохожими при увеличении расстояния между ними.\n\n-   В изотропном случае вектор $\\mathbf h$ можно заменить на его длину $|\\mathbf h|$.\n:::\n\n## Вариограммное облако\n\nКвадрат разности значений как функция от расстояния\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-1-1.png){width=1500}\n:::\n:::\n\n\nТочка на графике соответствует паре точек на местности.\n\n## Эмпирическая вариограмма\n\n**Эмпирическая вариограмма** рассчитывается путем разбения вариограммного облака на интервалы расстояний --- *лаги* --- и подсчета среднего значения в каждом лаге:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-2-1.png){width=1800}\n:::\n:::\n\n\n## Эмпирическая вариограмма\n\n$$\\widehat{\\gamma} = \\frac{1}{2N_h} \\sum_{|\\mathbf{p}_i - \\mathbf{p}_j| \\approx h} \\big(Z_i - Z_j\\big)^2$$\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-3-1.png){width=1800}\n:::\n:::\n\n\n## Интерпретация вариограммы\n\n1.  Вариограмма --- квадрат разницы значений. Чем она больше, тем сильнее различаются точки по величине показателя.\n2.  Меньшие значения $\\gamma$ свидетельствуют о большей похожести точек. Следовательно, вес таких точек при интерполяции должен быть выше.\n3.  Пока вариограмма растет, существует зависимость между значениями в точке. Даже для далеких $\\mathbf p_i$ мы можем сказать, насколько они в среднем отличаются от $\\mathbf p$. Это значит, что их веса должны быть ненулевыми.\n4.  Если вариограмма вышла на плато, то зависимость утрачена, и данными, расположенными за пределами радиуса корреляции, можно пренебречь, а их веса будут близки к нулю.\n\n## Модель вариограммы\n\nМодель вариограммы управляется тремя параметрами: эффект самородка (*nugget*), радиус корреляции (*range*) и плато (*sill*).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-4-1.png){width=1800}\n:::\n:::\n\n\n## Сферическая модель\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-5-1.png){width=1500}\n:::\n:::\n\n\n-   Данная модель достигает плато в точке $h = a$.\n\n-   За пределами радиуса корреляции зависимость отсутствует\n\n## Экспоненциальная модель\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-6-1.png){width=1500}\n:::\n:::\n\n\n-   Данная модель достигает плато асимптотически.\n-   В точке $h = a$ достигается $95\\%$ уровня плато.\n\n## Гауссова модель\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-7-1.png){width=1500}\n:::\n:::\n\n\n-   Данная модель достигает плато асимптотически.\n-   В точке $h = a$ достигается $95\\%$ уровня плато.\n\n## Степенная модель\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-8-1.png){width=1500}\n:::\n:::\n\n\n-   Зависимость присутствует на всех расстояниях: $a \\rightarrow \\infty$\n-   Как правило, это означает наличие тренда в данных\n\n## Кригинг\n\n**Кригинг** --- это *геостатистический* интерполятор вида [@krige:1951]:\n\n$$Z(\\mathbf p_0) = \\sum_{i} \\lambda_i Z(\\mathbf p_i) + \\lambda_0$$\n\nВ случае *обычного* кригинга веса определяются на основе вариограммы путем решения системы линейных уравнений:\n\n$$\n\\begin{cases}\\sum_j \\lambda_j \\gamma_{ij} - \\mu = \\gamma_{i0},\\color{gray}{~i = 1,...,N,}\\\\\n\\sum_i \\lambda_i = 1\n\\end{cases},\n$$ при условии $\\lambda_0 = 0$, где $\\gamma_{ij} = \\gamma(\\mathbf p_i - \\mathbf p_j)$, $p_0$ --- интерполируемая точка, $\\mu$ --- множитель Лагранжа, возникающий из-за дополнительного условия $\\sum_i \\lambda_i = 1$.\n\n## Кригинг\n\nОценка кригинга --- результат интерполяции методом кригинга. По виду похожа на метод РБФ, но статистически обоснована.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n## Кригинг\n\nДисперсия кригинга $\\sigma = \\sum_{i}\\lambda_i\\gamma_{i0} - \\mu$ --- неопределенность оценки, которая напрямую зависит от плотности исходных данных.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](08_Interpolation_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n## Словарик\n\n::: columns\n::: {.column width=\"50%\" style=\"color: blue; text-align: end;\"}\nПространственная статистика\n\nПространственная зависимость\n\nПространств. гетерогенность\n\nПространственная интерполяция\n\nБлижайший сосед\n\nОбр. взвешенные расстояния\n\nРадиальные базисные функции\n\nПолиномиальная регрессия\n\nГеостатистика\n\nВариограмма\n\nКригинг\n:::\n\n::: {.column width=\"50%\" style=\"color: red\"}\nSpatial statistics\n\nSpatial dependency\n\nSpatial heterogeneity\n\nSpatial inteprolation\n\nNearest neighbor\n\nInverse distance weighted\n\nRadial basis functions\n\nPolynomial regression\n\nGeostatistics\n\nVariogram\n\nKriging\n:::\n:::\n\n## Библиография\n",
    "supporting": [
      "08_Interpolation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}